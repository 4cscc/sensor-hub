- name: setup sensor-dashboard and establish service
  hosts: all
  tasks:

  - name: create directory
    file:
      path: /home/beta/sensor-hub
      state: directory

  - name: create virtualenv
    shell: \
      python3 -m virtualenv /home/beta/sensor-hub/



  - name: create environment
    pip:
      name:
      - pip
      - Cython
      - wheel
      - setuptools
      state: latest
      virtualenv: /home/beta/sensor-hub/
      virtualenv_command: virtualenv
      virtualenv_site_packages: true
      virtualenv_python: python3

  # - name: install numpy
    # shell: source /home/beta/sensor-hub/bin/activate && pip install numpy && pip install pandas
# 
  # - name: install pandas
    # pip:
      # name: pandas
      # state: latest
      # virtualenv: /home/beta/sensor-hub/
      # virtualenv_command: virtualenv
      # virtualenv_site_packages: true

  - name: install-sensor-dashboard
    pip:
      name: git+https://github.com/4cscc/sensor-dashboard.git@main
      state: latest
      virtualenv: /home/beta/sensor-hub/
      virtualenv_command: virtualenv
      virtualenv_site_packages: true
# 
  - name: install sensor-dashboard
    shell: /home/beta/sensor-hub/bin/pip install git+https://github.com/4cscc/sensor-dashboard.git@main

  - name: copy viz_dashboard systemd service setup file
    ansible.builtin.copy:
      src: ../setup_files/viz_dashboard.service
      dest: /lib/systemd/system/viz_dashboard.service
      force: yes
      mode: 0664

  - name: reload systemd daemon
    ansible.builtin.systemd:
      daemon_reload: yes